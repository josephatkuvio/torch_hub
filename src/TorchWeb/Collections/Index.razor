@using Microsoft.AspNetCore.Authorization;
@attribute [Authorize]
@page "/"

<div class="collections-index">
    <header>
        <div class="nav-header">
        <h1>All Collections</h1>
        <h1 @onclick=Go class="nav-admin-opt">Admin Page</h1>
        </div>
        <button @onclick=Add>Add New Collection</button>
    </header>

    @if (Model != null)
    {
        <section>
            @foreach (var collection in Model.Collections)
            {
                @if (collection.Deleted_date == null)
                {
                    <CollectionCard Collection="collection" />
                }
            }
        </section>
    }
</div>

@inject IModalService Modal
@code {

    CollectionsResponse? Model;
    protected override async Task OnInitializedAsync()
    {
        Model = await TorchCommands.GetCollectionsAsync();
    }

    async Task Add()
    {
        var modal = Modal.Show<AddCollection>();
        await modal.Result;
        Model = await TorchCommands.GetCollectionsAsync();
    }

    void Go() => Nav.NavigateTo($"/admin-page");
}